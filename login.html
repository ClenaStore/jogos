<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Login • Apostas Futebol</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#2563eb">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui}
body{margin:0;height:100vh;background:#f5f7fa;overflow:hidden}

/* FUNDO */
.bg-shape{position:absolute;width:120%;height:55%;border-radius:0 0 50% 50%}
.bg-top{background:linear-gradient(180deg,#ff9f1c,#ff7a00);top:-25%;left:-10%}
.bg-bottom{background:#1f4fd8;bottom:0;left:0;width:100%;height:18%;border-radius:0}

/* LAYOUT */
.container{
  position:relative;height:100%;
  display:flex;align-items:center;justify-content:center;padding:20px;
}
.card{
  width:100%;max-width:360px;background:#fff;border-radius:22px;
  padding:28px 24px 32px;
  box-shadow:0 20px 50px rgba(0,0,0,.12);
}

/* TABS */
.tabs{display:flex;margin-bottom:24px}
.tabs button{
  flex:1;border:none;background:none;font-size:18px;
  font-weight:700;padding-bottom:8px;cursor:pointer;color:#9ca3af;
}
.tabs button.active{color:#111827;border-bottom:2.5px solid #2563eb}

/* CAMPOS */
.field{margin-bottom:14px}
.field label{font-size:13px;color:#6b7280;margin-bottom:6px;display:block}
.field input{
  width:100%;
  padding:14px 16px;
  border-radius:16px;
  border:none;
  background:#eef4ff;
  font-size:15px;
}
.field input:focus{outline:none;background:#e7efff}

/* TERMOS */
.terms{
  display:flex;gap:10px;font-size:12.5px;color:#374151;
  margin:10px 0 6px;line-height:1.4;
}

/* BOTÃO */
.btn{
  width:100%;margin-top:10px;padding:14px;border:none;
  border-radius:16px;background:#2563eb;color:#fff;
  font-size:16px;font-weight:700;cursor:pointer;
}

/* ERRO */
.error{
  margin-top:12px;font-size:13px;color:#dc2626;
  display:none;text-align:center;
}

/* OVERLAY */
.overlay{
  position:fixed;inset:0;
  background:rgba(255,255,255,.85);
  display:none;align-items:center;justify-content:center;
  z-index:999;
}
.loader{
  width:42px;height:42px;
  border:4px solid #dbeafe;
  border-top-color:#2563eb;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="bg-shape bg-top"></div>
<div class="bg-shape bg-bottom"></div>

<div class="overlay" id="overlay">
  <div class="loader"></div>
</div>

<div class="container">
  <div class="card">

    <div class="tabs">
      <button id="tabLogin" class="active" type="button">Login</button>
      <button id="tabRegister" type="button">Cadastro</button>
    </div>

    <!-- LOGIN -->
    <div id="loginForm">
      <div class="field">
        <label>CPF</label>
        <input id="loginCpf" inputmode="numeric" placeholder="000.000.000-00">
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="loginPass">
      </div>
      <button class="btn" onclick="login()">Entrar</button>
    </div>

    <!-- CADASTRO -->
    <div id="registerForm" style="display:none">
      <div class="field">
        <label>Nome</label>
        <input id="regNome">
      </div>
      <div class="field">
        <label>CPF</label>
        <input id="regCpf" inputmode="numeric" placeholder="000.000.000-00">
      </div>
      <div class="field">
        <label>WhatsApp</label>
        <input id="regWhatsapp" inputmode="numeric" placeholder="(00) 00000-0000">
      </div>
      <div class="field">
        <label>Email</label>
        <input id="regEmail">
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="regPass">
      </div>

      <div class="terms">
        <input type="checkbox" id="aceiteTermos">
        <div>Sou maior de 18 anos e aceito a Política de Privacidade.</div>
      </div>

      <button class="btn" onclick="register()">Cadastrar</button>
    </div>

    <div class="error" id="msgErro"></div>

  </div>
</div>

<script>
const supabase = supabasejs.createClient(
  "https://qvlfuqxqxcgfjxkmtyyy.supabase.co",
  "sb_publishable_w5vrkvi_8rUGP3_vwofSIg_TD8XISuJ"
);

const overlay = document.getElementById("overlay");
const msgErro = document.getElementById("msgErro");

// sessão
if(localStorage.getItem("sessionUser")){
  location.href="index.html";
}

/* TABS */
tabLogin.onclick = showLogin;
tabRegister.onclick = showRegister;

function showLogin(){
  tabLogin.classList.add("active");
  tabRegister.classList.remove("active");
  loginForm.style.display="block";
  registerForm.style.display="none";
  msgErro.style.display="none";
}
function showRegister(){
  tabRegister.classList.add("active");
  tabLogin.classList.remove("active");
  loginForm.style.display="none";
  registerForm.style.display="block";
  msgErro.style.display="none";
}
function erro(msg){
  msgErro.innerText = msg;
  msgErro.style.display = "block";
}

/* MÁSCARAS */
function maskCpf(el){
  el.value = el.value.replace(/\D/g,'').slice(0,11)
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d{1,2})$/,'$1-$2');
}
function maskPhone(el){
  el.value = el.value.replace(/\D/g,'').slice(0,11)
    .replace(/(\d{2})(\d)/,'($1) $2')
    .replace(/(\d{5})(\d{4})$/,'$1-$2');
}

loginCpf.addEventListener("input", onLoginCpf);
regCpf.addEventListener("input", ()=>maskCpf(regCpf));
regWhatsapp.addEventListener("input", ()=>maskPhone(regWhatsapp));

/* VERIFICA CPF LOGIN */
async function onLoginCpf(){
  maskCpf(loginCpf);
  const cpf = loginCpf.value.replace(/\D/g,'');
  if(cpf.length !== 11) return;

  overlay.style.display="flex";
  try{
    const { data } = await supabase
      .from("usuarios")
      .select("id")
      .eq("cpf", loginCpf.value)
      .single();

    overlay.style.display="none";

    if(!data){
      showRegister();
      regCpf.value = loginCpf.value;
      erro("CPF não encontrado. Faça o cadastro.");
    }
  }catch{
    overlay.style.display="none";
    erro("Erro de conexão com o servidor.");
  }
}

/* LOGIN */
async function login(){
  overlay.style.display="flex";
  try{
    const { data, error } = await supabase
      .from("usuarios")
      .select("*")
      .eq("cpf",loginCpf.value)
      .eq("senha",loginPass.value)
      .single();

    overlay.style.display="none";

    if(error || !data){
      return erro("CPF ou senha inválidos");
    }

    localStorage.setItem("sessionUser", JSON.stringify(data));
    location.href="index.html";
  }catch{
    overlay.style.display="none";
    erro("Erro de conexão com o servidor");
  }
}

/* CADASTRO */
async function register(){
  if(!aceiteTermos.checked){
    return erro("É obrigatório aceitar os termos");
  }

  overlay.style.display="flex";
  try{
    const { error } = await supabase.from("usuarios").insert({
      nome:regNome.value,
      cpf:regCpf.value,
      whatsapp:regWhatsapp.value,
      email:regEmail.value,
      senha:regPass.value,
      aceitou_termos:true
    });

    overlay.style.display="none";

    if(error){
      return erro("Erro ao cadastrar usuário");
    }

    showLogin();
    erro("Cadastro realizado. Faça login.");
  }catch{
    overlay.style.display="none";
    erro("Erro de conexão com o servidor");
  }
}
</script>

</body>
</html>
