<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Apostas Futebol • Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#2563eb">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --blue:#2563eb;
  --blue-dark:#1e40af;
  --orange:#ff8a00;
  --bg:#f4f7fb;
}

*{box-sizing:border-box;font-family:Inter,system-ui}
body{
  margin:0;
  height:100vh;
  background:var(--bg);
  overflow:hidden;
}

/* BACKGROUND */
.bg-top{
  position:absolute;
  top:-28%;
  left:-10%;
  width:120%;
  height:55%;
  background:linear-gradient(180deg,#ffa31a,var(--orange));
  border-radius:0 0 50% 50%;
}
.bg-bottom{
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
  height:20%;
  background:linear-gradient(180deg,var(--blue),var(--blue-dark));
}

/* CONTAINER */
.container{
  position:relative;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

/* CARD */
.card{
  width:100%;
  max-width:380px;
  padding:30px 26px 34px;
  border-radius:24px;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(8px);
  box-shadow:
    0 30px 60px rgba(0,0,0,.15),
    inset 0 1px 0 rgba(255,255,255,.4);
  animation:fadeUp .6s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

/* TABS */
.tabs{
  position:relative;
  display:flex;
  margin-bottom:26px;
}
.tabs button{
  flex:1;
  background:none;
  border:none;
  font-size:18px;
  font-weight:700;
  padding-bottom:10px;
  cursor:pointer;
  color:#9ca3af;
}
.tabs button.active{color:#111827}

.tab-indicator{
  position:absolute;
  bottom:0;
  left:0;
  width:50%;
  height:3px;
  background:var(--blue);
  border-radius:99px;
  transition:.35s;
}

/* FORM */
.field{margin-bottom:16px}
.field label{
  font-size:13px;
  color:#6b7280;
  margin-bottom:6px;
  display:block;
}
.field input{
  width:100%;
  padding:15px 16px;
  border-radius:16px;
  border:none;
  background:#eef4ff;
  font-size:15px;
  transition:.25s;
}
.field input:focus{
  outline:none;
  background:#e7efff;
  box-shadow:0 0 0 2px rgba(37,99,235,.15);
}

/* BUTTON */
.btn{
  width:100%;
  margin-top:12px;
  padding:15px;
  border:none;
  border-radius:18px;
  background:linear-gradient(180deg,#3b82f6,var(--blue));
  color:#fff;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
  transition:.25s;
}
.btn:hover{filter:brightness(1.05)}
.btn:active{transform:scale(.98)}

/* TERMS */
.terms{
  display:flex;
  gap:10px;
  font-size:12.5px;
  color:#374151;
  margin:12px 0 4px;
}

/* ERROR */
.error{
  margin-top:14px;
  font-size:13px;
  color:#dc2626;
  text-align:center;
  display:none;
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.6);
  backdrop-filter:blur(4px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.loader{
  width:46px;
  height:46px;
  border:4px solid #dbeafe;
  border-top-color:var(--blue);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="bg-top"></div>
<div class="bg-bottom"></div>

<div class="overlay" id="overlay"><div class="loader"></div></div>

<div class="container">
  <div class="card">

    <div class="tabs">
      <button id="btnLogin" class="active">Login</button>
      <button id="btnRegister">Cadastro</button>
      <div class="tab-indicator" id="indicator"></div>
    </div>

    <!-- LOGIN -->
    <div id="loginForm">
      <div class="field">
        <label>CPF</label>
        <input id="loginCpf" inputmode="numeric" placeholder="000.000.000-00">
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="loginPass">
      </div>
      <button class="btn" id="loginBtn">Entrar</button>
    </div>

    <!-- CADASTRO -->
    <div id="registerForm" style="display:none">
      <div class="field"><label>Nome</label><input id="regNome"></div>
      <div class="field"><label>CPF</label><input id="regCpf" inputmode="numeric"></div>
      <div class="field"><label>WhatsApp</label><input id="regWhatsapp" inputmode="numeric"></div>
      <div class="field"><label>Email</label><input id="regEmail"></div>
      <div class="field"><label>Senha</label><input type="password" id="regPass"></div>

      <div class="terms">
        <input type="checkbox" id="aceiteTermos">
        <div>Sou maior de 18 anos e aceito a Política de Privacidade.</div>
      </div>

      <button class="btn" id="registerBtn">Cadastrar</button>
    </div>

    <div class="error" id="msgErro"></div>

  </div>
</div>

<script>
const supabase = supabasejs.createClient(
  "https://qvlfuqxqxcgfjxkmtyyy.supabase.co",
  "sb_publishable_w5vrkvi_8rUGP3_vwofSIg_TD8XISuJ"
);

const overlay = document.getElementById("overlay");
const erroBox = document.getElementById("msgErro");
const indicator = document.getElementById("indicator");

if(localStorage.getItem("sessionUser")){
  location.href="index.html";
}

/* UTIL */
const showOverlay = ()=>overlay.style.display="flex";
const hideOverlay = ()=>overlay.style.display="none";
const erro = msg=>{
  erroBox.innerText = msg;
  erroBox.style.display="block";
};

/* TABS */
btnLogin.onclick = ()=>{
  indicator.style.left="0";
  btnLogin.classList.add("active");
  btnRegister.classList.remove("active");
  loginForm.style.display="block";
  registerForm.style.display="none";
  erroBox.style.display="none";
};
btnRegister.onclick = ()=>{
  indicator.style.left="50%";
  btnRegister.classList.add("active");
  btnLogin.classList.remove("active");
  loginForm.style.display="none";
  registerForm.style.display="block";
  erroBox.style.display="none";
};

/* MASKS */
function maskCpf(el){
  el.value = el.value.replace(/\D/g,'').slice(0,11)
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d{1,2})$/,'$1-$2');
}
function maskPhone(el){
  el.value = el.value.replace(/\D/g,'').slice(0,11)
    .replace(/(\d{2})(\d)/,'($1) $2')
    .replace(/(\d{5})(\d{4})$/,'$1-$2');
}

/* EVENTS */
loginCpf.oninput = async ()=>{
  maskCpf(loginCpf);
  if(loginCpf.value.replace(/\D/g,'').length!==11) return;

  showOverlay();
  try{
    const { data } = await supabase
      .from("usuarios")
      .select("id")
      .eq("cpf",loginCpf.value)
      .single();

    hideOverlay();
    if(!data){
      btnRegister.click();
      regCpf.value = loginCpf.value;
      erro("CPF não encontrado. Faça o cadastro.");
    }
  }catch{
    hideOverlay();
    erro("Erro de conexão.");
  }
};

regCpf.oninput = ()=>maskCpf(regCpf);
regWhatsapp.oninput = ()=>maskPhone(regWhatsapp);

/* LOGIN */
loginBtn.onclick = async ()=>{
  showOverlay();
  try{
    const { data } = await supabase
      .from("usuarios")
      .select("*")
      .eq("cpf",loginCpf.value)
      .eq("senha",loginPass.value)
      .single();

    hideOverlay();
    if(!data) return erro("CPF ou senha inválidos");

    localStorage.setItem("sessionUser",JSON.stringify(data));
    location.href="index.html";
  }catch{
    hideOverlay();
    erro("Erro de conexão.");
  }
};

/* REGISTER */
registerBtn.onclick = async ()=>{
  if(!aceiteTermos.checked) return erro("Aceite os termos");

  showOverlay();
  try{
    const { data } = await supabase
      .from("usuarios")
      .select("id")
      .eq("cpf",regCpf.value)
      .single();

    if(data){
      hideOverlay();
      return erro("CPF já cadastrado.");
    }

    await supabase.from("usuarios").insert({
      nome:regNome.value,
      cpf:regCpf.value,
      whatsapp:regWhatsapp.value,
      email:regEmail.value,
      senha:regPass.value,
      aceitou_termos:true
    });

    hideOverlay();
    btnLogin.click();
    erro("Cadastro realizado. Faça login.");
  }catch{
    hideOverlay();
    erro("Erro de conexão.");
  }
};
</script>

</body>
</html>
