<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Login • Apostas Futebol</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#2563eb">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
  margin:0;height:100vh;background:#f5f7fa;overflow:hidden;
}
.bg-shape{position:absolute;width:120%;height:45%;border-radius:0 0 50% 50%}
.bg-top{background:linear-gradient(135deg,#ff7a00,#ffb347);top:-15%;left:-10%}
.bg-bottom{background:linear-gradient(135deg,#1e40af,#2563eb);bottom:-20%;right:-15%}

.container{
  position:relative;height:100%;
  display:flex;align-items:center;justify-content:center;padding:20px;
}
.card{
  width:100%;max-width:360px;background:#fff;border-radius:22px;
  padding:28px 24px 32px;
  box-shadow:0 20px 50px rgba(0,0,0,.12);
}
.tabs{display:flex;margin-bottom:24px}
.tabs button{
  flex:1;border:none;background:none;font-size:18px;
  font-weight:700;padding-bottom:8px;cursor:pointer;color:#9ca3af;
}
.tabs button.active{color:#111827;border-bottom:3px solid #2563eb}
.field{margin-bottom:14px}
.field label{font-size:13px;color:#6b7280;margin-bottom:6px;display:block}
.field input{
  width:100%;padding:14px;border-radius:14px;
  border:1px solid #e5e7eb;font-size:15px;
}
.field input:focus{outline:none;border-color:#2563eb}
.btn{
  width:100%;margin-top:8px;padding:14px;border:none;
  border-radius:16px;background:#2563eb;color:#fff;
  font-size:16px;font-weight:700;cursor:pointer;
}
.error{
  margin-top:12px;font-size:13px;color:#dc2626;
  display:none;text-align:center;
}
</style>
</head>

<body>

<div class="bg-shape bg-top"></div>
<div class="bg-shape bg-bottom"></div>

<div class="container">
  <div class="card">

    <div class="tabs">
      <button id="tabLogin" class="active" onclick="showLogin()">Login</button>
      <button id="tabRegister" onclick="showRegister()">Cadastro</button>
    </div>

    <!-- LOGIN -->
    <div id="loginForm">
      <div class="field">
        <label>CPF</label>
        <input id="loginCpf" placeholder="000.000.000-00">
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="loginPass">
      </div>
      <button class="btn" onclick="login()">Entrar</button>
    </div>

    <!-- CADASTRO -->
    <div id="registerForm" style="display:none">
      <div class="field">
        <label>Nome</label>
        <input id="regNome">
      </div>
      <div class="field">
        <label>CPF</label>
        <input id="regCpf" placeholder="000.000.000-00">
      </div>
      <div class="field">
        <label>WhatsApp</label>
        <input id="regWhatsapp" placeholder="(00) 00000-0000">
      </div>
      <div class="field">
        <label>Email</label>
        <input id="regEmail">
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="regPass">
      </div>
      <button class="btn" onclick="register()">Cadastrar</button>
    </div>

    <div class="error" id="msgErro"></div>

  </div>
</div>

<script>
const supabase = supabasejs.createClient(
  "SUPABASE_URL",
  "SUPABASE_ANON_KEY"
);

// sessão
if(localStorage.getItem("sessionUser")){
  window.location.href="index.html";
}

// máscaras
function maskCpf(el){
  el.value = el.value
    .replace(/\D/g,'')
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d)/,'$1.$2')
    .replace(/(\d{3})(\d{1,2})$/,'$1-$2');
}
function maskPhone(el){
  el.value = el.value
    .replace(/\D/g,'')
    .replace(/(\d{2})(\d)/,'($1) $2')
    .replace(/(\d{5})(\d{4})$/,'$1-$2');
}

loginCpf.oninput=()=>maskCpf(loginCpf);
regCpf.oninput=()=>maskCpf(regCpf);
regWhatsapp.oninput=()=>maskPhone(regWhatsapp);

function showLogin(){
  tabLogin.classList.add("active");
  tabRegister.classList.remove("active");
  loginForm.style.display="block";
  registerForm.style.display="none";
  msgErro.style.display="none";
}

function showRegister(){
  tabRegister.classList.add("active");
  tabLogin.classList.remove("active");
  loginForm.style.display="none";
  registerForm.style.display="block";
  msgErro.style.display="none";
}

function erro(msg){
  msgErro.innerText=msg;
  msgErro.style.display="block";
}

// LOGIN
async function login(){
  const cpf = loginCpf.value;
  const senha = loginPass.value;

  const { data, error } = await supabase
    .from("usuarios")
    .select("*")
    .eq("cpf",cpf)
    .eq("senha",senha)
    .single();

  if(error || !data){
    return erro("CPF ou senha inválidos");
  }

  localStorage.setItem("sessionUser", JSON.stringify(data));
  window.location.href="index.html";
}

// CADASTRO
async function register(){
  const nome = regNome.value;
  const cpf = regCpf.value;
  const whatsapp = regWhatsapp.value;
  const email = regEmail.value;
  const senha = regPass.value;

  if(!nome || !cpf || !whatsapp || !senha){
    return erro("Preencha todos os campos");
  }

  // verifica CPF
  const { data:existe } = await supabase
    .from("usuarios")
    .select("id")
    .eq("cpf",cpf)
    .single();

  if(existe){
    showLogin();
    return erro("CPF já cadastrado. Faça login.");
  }

  const { error } = await supabase
    .from("usuarios")
    .insert({ nome, cpf, whatsapp, email, senha });

  if(error){
    return erro("Erro ao cadastrar");
  }

  showLogin();
  erro("Cadastro realizado. Faça login.");
}
</script>

</body>
</html>
